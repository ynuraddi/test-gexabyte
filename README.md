# Задание:
Написать веб сервис для получения курса криптовалют. 
Курсы хранятся в базе данных mongo или postgres. 
Должна быть возможность посмотреть историю изменения стоимости криптовалюты. 
Сервис должен представлять API, работающий поверх HTTP в формате данных JSON.

Требования:
 - Язык программирования Go.
 - База данных MongoDB, PostgreSQL.
 - Данные по курсам валютных пар: BTCUSDT, ETHUSDT, SOLUSDT, TRXUSDT (можно добавить свою).
 - Если курсы не запрашивались в течение 10 минут, сервис сам получает актуальные курсы и сохраняет в базу.
 - Возможность получить краткую сводку с изменением курса криптовалют за 24 часа, минимальную, максимальную стоимость и цену.
 - Возможность получить изменения по курсу одной криптовалюты за 7 дней, 1 месяц, 3 месяца. Должна присутствовать пагинация.
 - Запуск в docker compose.
 - Результат работы в репозитории GitHub.
 - В качестве сервиса с курсами можно использовать Binance API или любой другой сервис. В одном запросе на такой сервис должны получать данные по одной паре.
 - Документация к использованию API.

Любые усложнения:
 - Использование Swagger
 - Использование кэша
 - Любые другие усложнения

---

# Дока:
 - Для запуска проекта используйте:
    ```
    docker-compose build
    docker-compose up
    ```
 - Swagger http://localhost:8080/swagger/index.html#/
 - Время сервера по UTC-0

# Обзор сервиса:
 - ```/currency [post]```
    Идея была в том что мой сервис будет парсить каждые 10 мин только те пары, которые добавлены в базу этим роутом.
 - ```/currencies [get]```
    Показывает как раз какие пары есть в базе данных
 - ```/prices [get]```
    Показывать записи в бд.
 - ```/prices/current [get]```
    Фетчит цены всех символов, сохраняет в базу только те который есть в бд, т.е. те которые мы отслеживаем
 - ```/prices/historical [get]```
    Тут мне кажется я намудрил с пагинацией, может понял неправильно понял. 
    Сделал через [kline](https://developers.binance.com/docs/binance-spot-api-docs/rest-api#klinecandlestick-data).
    Лимит тут выступает просто количеством элементов на странице.
    Работает так:
    1. Методом тыка понял как работает ```KLINE``` округление времени открытия и закрытия, интервалов и прочего.
    2. Теперь можно указать любой промежуток времени с любым интервалом, а limit  в свою очередь выступит кол-ом обьектов на странице (макс 1000), в ответе вернется maxPage который даст понять сколько страниц есть всего у такого разделения.
    Зато теперь ненужно запрашивать все данные.

    Сделал так чтобы не запрашивать весь интервал полностью каждый раз и делить его на страницы, а запрашивать именно ту страницу которую нужно получить. И кэшировать удобно было бы, вот отрезок и например в кэше лежит 1 и 7 страница.
    Думаю пагинация будет понятнее если взглянуть на тесты ./internal/service/currency/historical_test.go/TestSolvePagination()

    Только когда сдал понял что имелась ввиду возможно пагинация в бд, но опять же с интервалами непонятно, было бы примерно так же, только данные через вебсокет (чтобы не столкнуться с rate limit) нужно было бы еще парсить (каждую секунду за последние 3 месяца и грузить в бд).

 - ```/stat/24h [get]```
    Тут просто с бинанса берет инфу и выводит.

# Чего не успел сделать:
 - Интеграционные тесты для сервиса
 - Сделать обработку ошибок бинанса у клиента, выстроить их логику в сервис.
 - Поисправлять сервис:
    - Вынести работу с рутинами в отдельный пакет и просто вызывать результаты обработки, либо использовать какой-то другой пакет.
 - Добавить кэширование.
 - Сделать что-то с неймингом, он мне неочень нравится, наспех не придумал.
 - Добавить и структурировать логи.
 - Gracefull shutdown.
 - Можно было бы через запрос наверное еще узнавать часовой пояс и подстраивать UTC под него.